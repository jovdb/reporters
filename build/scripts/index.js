/// <reference path='../../typings/source-map/source-map.d.ts' />
var fs = require('fs');
var path = require('path');
var sourceMapResolve = require('source-map-resolve');
var sm = require('source-map');
var SourceMapConsumer = sm.SourceMapConsumer;
var stripBom = require('strip-bom');
/** Create a reporter for a specific node module, messages are captured and send to the output.
* @param name name of the internal reporter that captures messages
* @param options Optional options for this reporter
*/
function reporters(name, options) {
    // name
    reporters.logDebug('Get reporter \'' + name + '\'.');
    var reporterCreator = reporters.getInputCreator(name);
    if (!reporterCreator) {
        throw new Error('No reporter with name \'' + name + '\' available. Available reporters: ' + reporters.getAvailable().join(', '));
    }
    // Wrap Reporter to accept options
    return reporters.wrapReporter(name, reporterCreator, options);
}
/** Collection of reporters the gather information of different node modules in a uniform way to log them all in the same format. */
var reporters;
(function (reporters) {
    /** Enable debug messages */
    reporters.debug = false;
    /** Function or array of functions that can handle messages.
    * Assign one or more results from getOutput(...)
    */
    reporters.output = [getOutputCreator('vs-console')()];
    function logDebug() {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i - 0] = arguments[_i];
        }
        if (reporters.debug) {
            console.log.apply(console, args);
        }
    }
    reporters.logDebug = logDebug;
    /** Internal method to load modules from a subdir with a specific name */
    function loadModule(subFolder, moduleName) {
        var relPath = '../scripts/' + subFolder + '/' + moduleName + '.js'; // prefix path is to also work from unit test
        if (fs.existsSync(__dirname + '/' + relPath)) {
            return require('./' + relPath);
        }
        else {
            return null;
        }
    }
    /** Internal method to list available modules */
    function getModuleNames(subFolder) {
        var names = [];
        fs.readdirSync(__dirname + '/' + subFolder).forEach(function (fileName) {
            if (path.extname(fileName) === '.js') {
                names.push(fileName.substring(0, fileName.length - path.extname(fileName).length));
            }
        });
        return names;
    }
    /** Get a list of availabe built-in reporters that create messages */
    function getAvailable() {
        return getModuleNames('input');
    }
    reporters.getAvailable = getAvailable;
    /** Get function that creates a reporter for a node module
    * @param name name of the reporter to return a create method for
    */
    function getInputCreator(name) {
        return loadModule('input', name);
    }
    reporters.getInputCreator = getInputCreator;
    /** Get function that creates a function to handle messages
    * @param name name of the internal output handler to load that will report messages
    */
    function getOutputCreator(name) {
        return loadModule('output', name);
    }
    /** Get a preconfigured function that handles messages by name
    * Use reporters.getOutputs() to get a list of available outputs.
    * @param name name of the internal output handler to load that will report messages
    * @param options Optional options for this output
    */
    function getOutput(name, options) {
        var creator = getOutputCreator(name);
        if (!creator) {
            throw new Error('No output with name \'' + name + '\' available. Available outputs: ' + reporters.getOutputs().join(', '));
        }
        return creator(options);
    }
    reporters.getOutput = getOutput;
    /** Get a list of available functions that can handle messages */
    function getOutputs() {
        return getModuleNames('output');
    }
    reporters.getOutputs = getOutputs;
    /** Called before reporting
    * This is your change to filter or update messages
    */
    function filterOrUpdate(messages) {
        return messages;
    }
    reporters.filterOrUpdate = filterOrUpdate;
    function wrapReporter(sourceName, reporterCreator, options) {
        logDebug('Creating reporter \'' + sourceName + '\', options: ' + JSON.stringify(options));
        if (reporterCreator) {
            var done = function (messages) {
                logDebug('Extracted messages: ', messages);
                if (messages) {
                    reporters.report(messages);
                }
            };
            // Create reporter
            var reporter = reporterCreator(done, options);
            // Delegate to method
            return reporter;
        }
        ;
    }
    reporters.wrapReporter = wrapReporter;
    /** Get sourcemap of a message */
    function getSourceMap(message, cache) {
        if (cache === void 0) { cache = {}; }
        function addToCache(message, sourceMap) {
            if (message && message.filePath) {
                logDebug(message.filePath + ': added sourcemap to cache');
                cache[message.filePath] = sourceMap;
            }
        }
        function getFromCache(message) {
            if (message && message.filePath) {
                if (cache[message.filePath] !== undefined) {
                    logDebug(message.filePath + ': found sourcemap in cache');
                }
                return cache[message.filePath];
            }
            return null;
        }
        if (message && (!message.options || message.options && message.options.sourceMaps !== false)) {
            // Get from cache
            var cached = getFromCache(message);
            if (cached !== undefined) {
                return cached;
            }
            var contents;
            // Get content from Vinyl file
            if (message.getFile) {
                logDebug(message.filePath + ': a vinyl file is available in message!');
                var file = message.getFile();
                // gulp-sourcemaps
                if (file && file.sourceMap) {
                    logDebug(message.filePath + ': sourceMap found in vinyl file');
                    addToCache(message, file.sourceMap);
                    return file.sourceMap;
                }
                else {
                    logDebug(message.filePath + ': no .sourceMap in vinyl file (gulp-sourcemaps)');
                }
                // find sourcemap comments in contents
                if (file && file.contents) {
                    logDebug(message.filePath + ': sourcemap comments in contents of vinyl file?');
                    var originalMap = sourceMapResolve.resolveSync(file.contents.toString('utf8'), message.filePath, fs.readFileSync);
                    if (originalMap) {
                        logDebug(message.filePath + ': sourcemap found in contents of vinyl file!');
                        addToCache(message, originalMap.map);
                        return originalMap.map;
                    }
                    else {
                        logDebug(message.filePath + ': no sourcemap found in contents of vinyl file!');
                    }
                }
                else {
                    logDebug(message.filePath + ': no .contents in vinyl file, are you sure that you passed a vinyl file?');
                }
                if (!contents) {
                    logDebug(message.filePath + ': no sourcemap found in vinyl file.');
                }
            }
            else {
                logDebug(message.filePath + ': no vinyl file available in message (getFile method)');
            }
            // Find sourcemap inside file
            if (!contents) {
                try {
                    logDebug(message.filePath + ': reading file');
                    var buffer = fs.readFileSync(message.filePath);
                    contents = buffer.toString();
                    if (contents) {
                        logDebug(message.filePath + ': resolving sourcemap');
                        originalMap = sourceMapResolve.resolveSync(contents, message.filePath, fs.readFileSync);
                        if (originalMap) {
                            logDebug(message.filePath + ': sourcemap found!');
                            addToCache(message, originalMap.map);
                            return originalMap.map;
                        }
                        else {
                            logDebug(message.filePath + ': sourcemap not found.');
                        }
                    }
                }
                catch (e) {
                    logDebug(message.filePath + ': error reading: ' + e.message);
                }
            }
            try {
                var mapFile = message.filePath + '.map';
                logDebug(mapFile + ': reading file (if exists)');
                var sourceMap = JSON.parse(stripBom(fs.readFileSync(mapFile, 'utf8')));
                if (sourceMap) {
                    addToCache(message, sourceMap);
                    return sourceMap;
                }
                else {
                    logDebug(mapFile + ': Original location not found.');
                }
            }
            catch (e) {
                logDebug(mapFile + ': error reading: ' + e.message);
            }
        }
        else {
            logDebug(message.filePath + ': sourcemaps disabled by options');
        }
        addToCache(message, null); // null means not available
        return null;
    }
    /** Report messages to the configured outputs
    * @param messages a list of messages that should be handled by the output (list).
    */
    function report(messages) {
        if (!messages) {
            return;
        }
        var cache = {};
        // Validate or convert output lists
        var outputs = [];
        if (typeof reporters.output === 'function') {
            outputs = [reporters.output];
        }
        else if (Array.isArray(reporters.output)) {
            if (reporters.output.some(function (o) { return typeof o !== 'function'; })) {
                throw new Error('reporters.output needs a function or array of functions to report messages.');
            }
            outputs = reporters.output;
        }
        else {
            throw new Error('reporters.output needs a function or array of functions to report messages.');
        }
        // check for sourcemap
        messages.forEach(function (message) {
            /// Add sourcemap information?
            if (!message.options || message.options.sourceMaps !== false) {
                logDebug(message.filePath + ': checking for sourcemaps...');
                var sourceMap = getSourceMap(message, cache);
                if (sourceMap) {
                    // Try to get original location
                    logDebug(message.filePath + ': get original location of line ' + message.lineNbr + ', col ' + message.colNbr);
                    var smc = new SourceMapConsumer(sourceMap);
                    var original = smc.originalPositionFor({ line: message.lineNbr - 1, column: message.colNbr - 1 });
                    logDebug(message.filePath + ': original location result: ' + JSON.stringify(original));
                    if (original && original.source) {
                        logDebug(message.filePath + ': updating message with sourcemap location');
                        message.filePath = original.source;
                        message.lineNbr = original.line + 1;
                        message.colNbr = original.column + 1;
                    }
                    else {
                        logDebug('line & column not found in sourceMap');
                    }
                }
            }
        });
        // Filter or update messages
        if (reporters.filterOrUpdate) {
            logDebug('Filtering messages: filterOrUpdate');
            messages = reporters.filterOrUpdate(messages);
        }
        // Report
        logDebug('# Outputs: ' + outputs.length);
        outputs.forEach(function (outputReporter) {
            outputReporter(messages);
        });
    }
    reporters.report = report;
})(reporters || (reporters = {}));
module.exports = reporters;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbInJlcG9ydGVycyIsInJlcG9ydGVycy5sb2dEZWJ1ZyIsInJlcG9ydGVycy5sb2FkTW9kdWxlIiwicmVwb3J0ZXJzLmdldE1vZHVsZU5hbWVzIiwicmVwb3J0ZXJzLmdldEF2YWlsYWJsZSIsInJlcG9ydGVycy5nZXRJbnB1dENyZWF0b3IiLCJyZXBvcnRlcnMuZ2V0T3V0cHV0Q3JlYXRvciIsInJlcG9ydGVycy5nZXRPdXRwdXQiLCJyZXBvcnRlcnMuZ2V0T3V0cHV0cyIsInJlcG9ydGVycy5maWx0ZXJPclVwZGF0ZSIsInJlcG9ydGVycy53cmFwUmVwb3J0ZXIiLCJyZXBvcnRlcnMuZ2V0U291cmNlTWFwIiwicmVwb3J0ZXJzLmdldFNvdXJjZU1hcC5hZGRUb0NhY2hlIiwicmVwb3J0ZXJzLmdldFNvdXJjZU1hcC5nZXRGcm9tQ2FjaGUiLCJyZXBvcnRlcnMucmVwb3J0Il0sIm1hcHBpbmdzIjoiQUFBQSxpRUFBaUU7QUFFakUsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFDMUIsSUFBTyxJQUFJLFdBQVcsTUFBTSxDQUFDLENBQUM7QUFDOUIsSUFBSSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQztBQUNyRCxJQUFPLEVBQUUsV0FBVyxZQUFZLENBQUMsQ0FBQztBQUNsQyxJQUFJLGlCQUFpQixHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztBQUM3QyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFcEMsQUFJQTs7O0VBREU7U0FDTyxTQUFTLENBQUMsSUFBWSxFQUFFLE9BQXVCO0lBRXREQSxBQUNBQSxPQURPQTtJQUNQQSxTQUFTQSxDQUFDQSxRQUFRQSxDQUFDQSxpQkFBaUJBLEdBQUdBLElBQUlBLEdBQUdBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3JEQSxJQUFJQSxlQUFlQSxHQUFHQSxTQUFTQSxDQUFDQSxlQUFlQSxDQUFDQSxJQUFJQSxDQUFD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LENBQUNBO29CQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTt3QkFDTkEsUUFBUUEsQ0FBQ0Esc0NBQXNDQSxDQUFDQSxDQUFDQTtvQkFDbkRBLENBQUNBO2dCQUNIQSxDQUFDQTtZQUNIQSxDQUFDQTtRQUNIQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVIQSxBQUNBQSw0QkFENEJBO1FBQzVCQSxFQUFFQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxjQUFjQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM3QkEsUUFBUUEsQ0FBQ0Esb0NBQW9DQSxDQUFDQSxDQUFDQTtZQUMvQ0EsUUFBUUEsR0FBR0EsU0FBU0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDaERBLENBQUNBO1FBRURBLEFBQ0FBLFNBRFNBO1FBQ1RBLFFBQVFBLENBQUNBLGFBQWFBLEdBQUdBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3pDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFBQSxjQUFjQTtZQUM1QkEsY0FBY0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDM0JBLENBQUNBLENBQUNBLENBQUNBO0lBQ0xBLENBQUNBO0lBN0RlZCxnQkFBTUEsR0FBTkEsTUE2RGZBLENBQUFBO0FBRUhBLENBQUNBLEVBaFNNLFNBQVMsS0FBVCxTQUFTLFFBZ1NmO0FBRUQsQUFBbUIsaUJBQVYsU0FBUyxDQUFDIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcam9fdmRfMDAwXFxEcm9wYm94XFwyMDE1XFxyZXBvcnRlcnMtZ2l0XFxzcmMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPScuLi8uLi90eXBpbmdzL3NvdXJjZS1tYXAvc291cmNlLW1hcC5kLnRzJyAvPlxyXG5cclxuaW1wb3J0IGZzID0gcmVxdWlyZSgnZnMnKTtcclxuaW1wb3J0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XHJcbnZhciBzb3VyY2VNYXBSZXNvbHZlID0gcmVxdWlyZSgnc291cmNlLW1hcC1yZXNvbHZlJyk7XHJcbmltcG9ydCBzbSA9IHJlcXVpcmUoJ3NvdXJjZS1tYXAnKTtcclxudmFyIFNvdXJjZU1hcENvbnN1bWVyID0gc20uU291cmNlTWFwQ29uc3VtZXI7XHJcbnZhciBzdHJpcEJvbSA9IHJlcXVpcmUoJ3N0cmlwLWJvbScpO1xyXG5cclxuLyoqIENyZWF0ZSBhIHJlcG9ydGVyIGZvciBhIHNwZWNpZmljIG5vZGUgbW9kdWxlLCBtZXNzYWdlcyBhcmUgY2FwdHVyZWQgYW5kIHNlbmQgdG8gdGhlIG91dHB1dC5cclxuKiBAcGFyYW0gbmFtZSBuYW1lIG9mIHRoZSBpbnRlcm5hbCByZXBvcnRlciB0aGF0IGNhcHR1cmVzIG1lc3NhZ2VzXHJcbiogQHBhcmFtIG9wdGlvbnMgT3B0aW9uYWwgb3B0aW9ucyBmb3IgdGhpcyByZXBvcnRlclxyXG4qL1xyXG5mdW5jdGlvbiByZXBvcnRlcnMobmFtZTogc3RyaW5nLCBvcHRpb25zPzogSUlucHV0T3B0aW9ucyk6IElJbnB1dCB7XHJcblxyXG4gIC8vIG5hbWVcclxuICByZXBvcnRlcnMubG9nRGVidWcoJ0dldCByZXBvcnRlciBcXCcnICsgbmFtZSArICdcXCcuJyk7XHJcbiAgdmFyIHJlcG9ydGVyQ3JlYXRvciA9IHJlcG9ydGVycy5nZXRJbnB1dENyZWF0b3IobmFtZSk7XHJcbiAgaWYgKCFyZXBvcnRlckNyZWF0b3IpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignTm8gcmVwb3J0ZXIgd2l0aCBuYW1lIFxcJycgKyBuYW1lICsgJ1xcJyBhdmFpbGFibGUuIEF2YWlsYWJsZSByZXBvcnRlcnM6ICcgKyByZXBvcnRlcnMuZ2V0QXZhaWxhYmxlKCkuam9pbignLCAnKSk7XHJcbiAgfVxyXG5cclxuICAvLyBXcmFwIFJlcG9ydGVyIHRvIGFjY2VwdCBvcHRpb25zXHJcbiAgcmV0dXJuIHJlcG9ydGVycy53cmFwUmVwb3J0ZXIobmFtZSwgcmVwb3J0ZXJDcmVhdG9yLCBvcHRpb25zKTtcclxuXHJcbn1cclxuXHJcbi8qKiBDb2xsZWN0aW9uIG9mIHJlcG9ydGVycyB0aGUgZ2F0aGVyIGluZm9ybWF0aW9uIG9mIGRpZmZlcmVudCBub2RlIG1vZHVsZXMgaW4gYSB1bmlmb3JtIHdheSB0byBsb2cgdGhlbSBhbGwgaW4gdGhlIHNhbWUgZm9ybWF0LiAqL1xyXG5tb2R1bGUgcmVwb3J0ZXJzIHtcclxuXHJcbiAgLyoqIEVuYWJsZSBkZWJ1ZyBtZXNzYWdlcyAqL1xyXG4gIGV4cG9ydCB2YXIgZGVidWcgPSBmYWxzZTtcclxuXHJcbiAgLyoqIEZ1bmN0aW9uIG9yIGFycmF5IG9mIGZ1bmN0aW9ucyB0aGF0IGNhbiBoYW5kbGUgbWVzc2FnZXMuXHJcbiAgKiBBc3NpZ24gb25lIG9yIG1vcmUgcmVzdWx0cyBmcm9tIGdldE91dHB1dCguLi4pXHJcbiAgKi9cclxuICBleHBvcnQgdmFyIG91dHB1dDogSU91dHB1dFtdIHwgSU91dHB1dCA9IFtnZXRPdXRwdXRDcmVhdG9yKCd2cy1jb25zb2xlJykoKV07XHJcblxyXG4gIGV4cG9ydCBmdW5jdGlvbiBsb2dEZWJ1ZyguLi5hcmdzOiBhbnlbXSk6IHZvaWQge1xyXG4gICAgaWYgKHJlcG9ydGVycy5kZWJ1Zykge1xyXG4gICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmdzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKiBJbnRlcm5hbCBtZXRob2QgdG8gbG9hZCBtb2R1bGVzIGZyb20gYSBzdWJkaXIgd2l0aCBhIHNwZWNpZmljIG5hbWUgKi9cclxuICBmdW5jdGlvbiBsb2FkTW9kdWxlPFRSZXN1bHQ+KHN1YkZvbGRlcjogc3RyaW5nLCBtb2R1bGVOYW1lOiBzdHJpbmcpOiBUUmVzdWx0IHtcclxuICAgIHZhciByZWxQYXRoID0gJy4uL3NjcmlwdHMvJyArIHN1YkZvbGRlciArICcvJyArIG1vZHVsZU5hbWUgKyAnLmpzJzsgLy8gcHJlZml4IHBhdGggaXMgdG8gYWxzbyB3b3JrIGZyb20gdW5pdCB0ZXN0XHJcblxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoX19kaXJuYW1lICsgJy8nICsgcmVsUGF0aCkpIHtcclxuICAgICAgcmV0dXJuIHJlcXVpcmUoJy4vJyArIHJlbFBhdGgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKiogSW50ZXJuYWwgbWV0aG9kIHRvIGxpc3QgYXZhaWxhYmxlIG1vZHVsZXMgKi9cclxuICBmdW5jdGlvbiBnZXRNb2R1bGVOYW1lcyhzdWJGb2xkZXI6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIHZhciBuYW1lczogc3RyaW5nW10gPSBbXTtcclxuICAgIGZzLnJlYWRkaXJTeW5jKF9fZGlybmFtZSArICcvJyArIHN1YkZvbGRlcikuZm9yRWFjaChmdW5jdGlvbiAoZmlsZU5hbWU6IHN0cmluZykge1xyXG4gICAgICBpZiAocGF0aC5leHRuYW1lKGZpbGVOYW1lKSA9PT0gJy5qcycpIHsgLy8gZW5kcyB3aXRoICcuanMnXHJcbiAgICAgICAgbmFtZXMucHVzaChmaWxlTmFtZS5zdWJzdHJpbmcoMCwgZmlsZU5hbWUubGVuZ3RoIC0gcGF0aC5leHRuYW1lKGZpbGVOYW1lKS5sZW5ndGgpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbmFtZXM7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IGEgbGlzdCBvZiBhdmFpbGFiZSBidWlsdC1pbiByZXBvcnRlcnMgdGhhdCBjcmVhdGUgbWVzc2FnZXMgKi9cclxuICBleHBvcnQgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlKCk6IHN0cmluZ1tdIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGVOYW1lcygnaW5wdXQnKTtcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgZnVuY3Rpb24gdGhhdCBjcmVhdGVzIGEgcmVwb3J0ZXIgZm9yIGEgbm9kZSBtb2R1bGUgXHJcbiAgKiBAcGFyYW0gbmFtZSBuYW1lIG9mIHRoZSByZXBvcnRlciB0byByZXR1cm4gYSBjcmVhdGUgbWV0aG9kIGZvclxyXG4gICovXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGdldElucHV0Q3JlYXRvcihuYW1lOiBzdHJpbmcpOiBJSW5wdXRDcmVhdG9yIHtcclxuICAgIHJldHVybiBsb2FkTW9kdWxlPElJbnB1dENyZWF0b3I+KCdpbnB1dCcsIG5hbWUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIEdldCBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgYSBmdW5jdGlvbiB0byBoYW5kbGUgbWVzc2FnZXMgXHJcbiAgKiBAcGFyYW0gbmFtZSBuYW1lIG9mIHRoZSBpbnRlcm5hbCBvdXRwdXQgaGFuZGxlciB0byBsb2FkIHRoYXQgd2lsbCByZXBvcnQgbWVzc2FnZXNcclxuICAqL1xyXG4gIGZ1bmN0aW9uIGdldE91dHB1dENyZWF0b3IobmFtZTogc3RyaW5nKTogSU91dHB1dENyZWF0b3Ige1xyXG4gICAgcmV0dXJuIGxvYWRNb2R1bGU8SU91dHB1dENyZWF0b3I+KCdvdXRwdXQnLCBuYW1lKTtcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgYSBwcmVjb25maWd1cmVkIGZ1bmN0aW9uIHRoYXQgaGFuZGxlcyBtZXNzYWdlcyBieSBuYW1lXHJcbiAgKiBVc2UgcmVwb3J0ZXJzLmdldE91dHB1dHMoKSB0byBnZXQgYSBsaXN0IG9mIGF2YWlsYWJsZSBvdXRwdXRzLlxyXG4gICogQHBhcmFtIG5hbWUgbmFtZSBvZiB0aGUgaW50ZXJuYWwgb3V0cHV0IGhhbmRsZXIgdG8gbG9hZCB0aGF0IHdpbGwgcmVwb3J0IG1lc3NhZ2VzXHJcbiAgKiBAcGFyYW0gb3B0aW9ucyBPcHRpb25hbCBvcHRpb25zIGZvciB0aGlzIG91dHB1dFxyXG4gICovXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGdldE91dHB1dChuYW1lOiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpOiBJT3V0cHV0IHtcclxuICAgIHZhciBjcmVhdG9yID0gZ2V0T3V0cHV0Q3JlYXRvcihuYW1lKTtcclxuICAgIGlmICghY3JlYXRvcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG91dHB1dCB3aXRoIG5hbWUgXFwnJyArIG5hbWUgKyAnXFwnIGF2YWlsYWJsZS4gQXZhaWxhYmxlIG91dHB1dHM6ICcgKyByZXBvcnRlcnMuZ2V0T3V0cHV0cygpLmpvaW4oJywgJykpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNyZWF0b3Iob3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICAvKiogR2V0IGEgbGlzdCBvZiBhdmFpbGFibGUgZnVuY3Rpb25zIHRoYXQgY2FuIGhhbmRsZSBtZXNzYWdlcyAqL1xyXG4gIGV4cG9ydCBmdW5jdGlvbiBnZXRPdXRwdXRzKCk6IHN0cmluZ1tdIHtcclxuICAgIHJldHVybiBnZXRNb2R1bGVOYW1lcygnb3V0cHV0Jyk7XHJcbiAgfVxyXG5cclxuICAvKiogQ2FsbGVkIGJlZm9yZSByZXBvcnRpbmdcclxuICAqIFRoaXMgaXMgeW91ciBjaGFuZ2UgdG8gZmlsdGVyIG9yIHVwZGF0ZSBtZXNzYWdlc1xyXG4gICovXHJcbiAgZXhwb3J0IGZ1bmN0aW9uIGZpbHRlck9yVXBkYXRlKG1lc3NhZ2VzOiBJTWVzc2FnZVtdKTogSU1lc3NhZ2VbXSB7XHJcbiAgICByZXR1cm4gbWVzc2FnZXM7XHJcbiAgfVxyXG5cclxuICBleHBvcnQgZnVuY3Rpb24gd3JhcFJlcG9ydGVyKHNvdXJjZU5hbWU6IHN0cmluZywgcmVwb3J0ZXJDcmVhdG9yOiBJSW5wdXRDcmVhdG9yLCBvcHRpb25zPzogSUlucHV0T3B0aW9ucyk6IElJbnB1dCB7XHJcblxyXG4gICAgbG9nRGVidWcoJ0NyZWF0aW5nIHJlcG9ydGVyIFxcJycgKyBzb3VyY2VOYW1lICsgJ1xcJywgb3B0aW9uczogJyArIEpTT04uc3RyaW5naWZ5KG9wdGlvbnMpKTtcclxuXHJcbiAgICBpZiAocmVwb3J0ZXJDcmVhdG9yKSB7XHJcblxyXG4gICAgICB2YXIgZG9uZSA9IGZ1bmN0aW9uIChtZXNzYWdlczogSU1lc3NhZ2VbXSkgeyAvLyBGb3IgYXN5bmMgY2FsbHNcclxuICAgICAgICBsb2dEZWJ1ZygnRXh0cmFjdGVkIG1lc3NhZ2VzOiAnLCBtZXNzYWdlcyk7XHJcbiAgICAgICAgaWYgKG1lc3NhZ2VzKSB7XHJcbiAgICAgICAgICAgIHJlcG9ydGVycy5yZXBvcnQobWVzc2FnZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSByZXBvcnRlclxyXG4gICAgICB2YXIgcmVwb3J0ZXIgPSByZXBvcnRlckNyZWF0b3IoZG9uZSwgb3B0aW9ucyk7XHJcblxyXG4gICAgICAvLyBEZWxlZ2F0ZSB0byBtZXRob2RcclxuICAgICAgcmV0dXJuIHJlcG9ydGVyO1xyXG5cclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKiogUmVwcmVzZW50cyB0aGUgY2FjaGUgKi9cclxuICBpbnRlcmZhY2UgSUNhY2hlIHtcclxuICAgIFtmaWxlUGF0aDogc3RyaW5nXTogU291cmNlTWFwLlJhd1NvdXJjZU1hcDtcclxuICB9XHJcblxyXG4gIC8qKiBHZXQgc291cmNlbWFwIG9mIGEgbWVzc2FnZSAqL1xyXG4gIGZ1bmN0aW9uIGdldFNvdXJjZU1hcChtZXNzYWdlOiBJTWVzc2FnZSwgY2FjaGU6IElDYWNoZSA9IHt9KTogU291cmNlTWFwLlJhd1NvdXJjZU1hcCB7XHJcblxyXG4gICAgZnVuY3Rpb24gYWRkVG9DYWNoZShtZXNzYWdlOiBJTWVzc2FnZSwgc291cmNlTWFwOiBTb3VyY2VNYXAuUmF3U291cmNlTWFwKTogdm9pZCB7XHJcbiAgICAgIGlmIChtZXNzYWdlICYmIG1lc3NhZ2UuZmlsZVBhdGgpIHtcclxuICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogYWRkZWQgc291cmNlbWFwIHRvIGNhY2hlJyk7XHJcbiAgICAgICAgY2FjaGVbbWVzc2FnZS5maWxlUGF0aF0gPSBzb3VyY2VNYXA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRGcm9tQ2FjaGUobWVzc2FnZTogSU1lc3NhZ2UpOiBTb3VyY2VNYXAuUmF3U291cmNlTWFwIHtcclxuICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZS5maWxlUGF0aCkge1xyXG4gICAgICAgIGlmIChjYWNoZVttZXNzYWdlLmZpbGVQYXRoXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogZm91bmQgc291cmNlbWFwIGluIGNhY2hlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYWNoZVttZXNzYWdlLmZpbGVQYXRoXTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobWVzc2FnZSAmJiAoIW1lc3NhZ2Uub3B0aW9ucyB8fCBtZXNzYWdlLm9wdGlvbnMgJiYgbWVzc2FnZS5vcHRpb25zLnNvdXJjZU1hcHMgIT09IGZhbHNlKSkge1xyXG5cclxuICAgICAgLy8gR2V0IGZyb20gY2FjaGVcclxuICAgICAgdmFyIGNhY2hlZCA9IGdldEZyb21DYWNoZShtZXNzYWdlKTtcclxuICAgICAgaWYgKGNhY2hlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIGNhY2hlZDtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIGNvbnRlbnRzOiBhbnk7XHJcblxyXG4gICAgICAvLyBHZXQgY29udGVudCBmcm9tIFZpbnlsIGZpbGVcclxuICAgICAgaWYgKG1lc3NhZ2UuZ2V0RmlsZSkge1xyXG4gICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBhIHZpbnlsIGZpbGUgaXMgYXZhaWxhYmxlIGluIG1lc3NhZ2UhJyk7XHJcbiAgICAgICAgdmFyIGZpbGUgPSBtZXNzYWdlLmdldEZpbGUoKTtcclxuXHJcbiAgICAgICAgLy8gZ3VscC1zb3VyY2VtYXBzXHJcbiAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5zb3VyY2VNYXApIHtcclxuICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBzb3VyY2VNYXAgZm91bmQgaW4gdmlueWwgZmlsZScpO1xyXG4gICAgICAgICAgYWRkVG9DYWNoZShtZXNzYWdlLCBmaWxlLnNvdXJjZU1hcCk7XHJcbiAgICAgICAgICByZXR1cm4gZmlsZS5zb3VyY2VNYXA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBubyAuc291cmNlTWFwIGluIHZpbnlsIGZpbGUgKGd1bHAtc291cmNlbWFwcyknKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGZpbmQgc291cmNlbWFwIGNvbW1lbnRzIGluIGNvbnRlbnRzXHJcbiAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5jb250ZW50cykge1xyXG4gICAgICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHNvdXJjZW1hcCBjb21tZW50cyBpbiBjb250ZW50cyBvZiB2aW55bCBmaWxlPycpO1xyXG4gICAgICAgICAgdmFyIG9yaWdpbmFsTWFwID0gc291cmNlTWFwUmVzb2x2ZS5yZXNvbHZlU3luYyhmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCd1dGY4JyksIG1lc3NhZ2UuZmlsZVBhdGgsIGZzLnJlYWRGaWxlU3luYyk7XHJcbiAgICAgICAgICBpZiAob3JpZ2luYWxNYXApIHtcclxuICAgICAgICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHNvdXJjZW1hcCBmb3VuZCBpbiBjb250ZW50cyBvZiB2aW55bCBmaWxlIScpO1xyXG4gICAgICAgICAgICBhZGRUb0NhY2hlKG1lc3NhZ2UsIG9yaWdpbmFsTWFwLm1hcCk7XHJcbiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbE1hcC5tYXA7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogbm8gc291cmNlbWFwIGZvdW5kIGluIGNvbnRlbnRzIG9mIHZpbnlsIGZpbGUhJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBubyAuY29udGVudHMgaW4gdmlueWwgZmlsZSwgYXJlIHlvdSBzdXJlIHRoYXQgeW91IHBhc3NlZCBhIHZpbnlsIGZpbGU/Jyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIWNvbnRlbnRzKSB7XHJcbiAgICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogbm8gc291cmNlbWFwIGZvdW5kIGluIHZpbnlsIGZpbGUuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBubyB2aW55bCBmaWxlIGF2YWlsYWJsZSBpbiBtZXNzYWdlIChnZXRGaWxlIG1ldGhvZCknKTtcclxuICAgICAgfVxyXG5cclxuXHJcbiAgICAgIC8vIEZpbmQgc291cmNlbWFwIGluc2lkZSBmaWxlXHJcbiAgICAgIGlmICghY29udGVudHMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHJlYWRpbmcgZmlsZScpO1xyXG4gICAgICAgICAgdmFyIGJ1ZmZlciA9IGZzLnJlYWRGaWxlU3luYyhtZXNzYWdlLmZpbGVQYXRoKTtcclxuICAgICAgICAgIGNvbnRlbnRzID0gYnVmZmVyLnRvU3RyaW5nKCk7XHJcblxyXG4gICAgICAgICAgaWYgKGNvbnRlbnRzKSB7XHJcbiAgICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiByZXNvbHZpbmcgc291cmNlbWFwJyk7XHJcbiAgICAgICAgICAgIG9yaWdpbmFsTWFwID0gc291cmNlTWFwUmVzb2x2ZS5yZXNvbHZlU3luYyhjb250ZW50cywgbWVzc2FnZS5maWxlUGF0aCwgZnMucmVhZEZpbGVTeW5jKTtcclxuICAgICAgICAgICAgaWYgKG9yaWdpbmFsTWFwKSB7XHJcbiAgICAgICAgICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHNvdXJjZW1hcCBmb3VuZCEnKTtcclxuICAgICAgICAgICAgICBhZGRUb0NhY2hlKG1lc3NhZ2UsIG9yaWdpbmFsTWFwLm1hcCk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsTWFwLm1hcDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogc291cmNlbWFwIG5vdCBmb3VuZC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBlcnJvciByZWFkaW5nOiAnICsgZS5tZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEZpbmQgaW4gLk1hcCBmaWxlXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdmFyIG1hcEZpbGUgPSBtZXNzYWdlLmZpbGVQYXRoICsgJy5tYXAnO1xyXG4gICAgICAgIGxvZ0RlYnVnKG1hcEZpbGUgKyAnOiByZWFkaW5nIGZpbGUgKGlmIGV4aXN0cyknKTtcclxuICAgICAgICB2YXIgc291cmNlTWFwID0gSlNPTi5wYXJzZShzdHJpcEJvbShmcy5yZWFkRmlsZVN5bmMobWFwRmlsZSwgJ3V0ZjgnKSkpO1xyXG5cclxuICAgICAgICBpZiAoc291cmNlTWFwKSB7XHJcbiAgICAgICAgICBhZGRUb0NhY2hlKG1lc3NhZ2UsIHNvdXJjZU1hcCk7XHJcbiAgICAgICAgICByZXR1cm4gc291cmNlTWFwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsb2dEZWJ1ZyhtYXBGaWxlICsgJzogT3JpZ2luYWwgbG9jYXRpb24gbm90IGZvdW5kLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIGxvZ0RlYnVnKG1hcEZpbGUgKyAnOiBlcnJvciByZWFkaW5nOiAnICsgZS5tZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHNvdXJjZW1hcHMgZGlzYWJsZWQgYnkgb3B0aW9ucycpO1xyXG4gICAgfVxyXG5cclxuICAgIGFkZFRvQ2FjaGUobWVzc2FnZSwgbnVsbCk7IC8vIG51bGwgbWVhbnMgbm90IGF2YWlsYWJsZVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICAvKiogUmVwb3J0IG1lc3NhZ2VzIHRvIHRoZSBjb25maWd1cmVkIG91dHB1dHMgXHJcbiAgKiBAcGFyYW0gbWVzc2FnZXMgYSBsaXN0IG9mIG1lc3NhZ2VzIHRoYXQgc2hvdWxkIGJlIGhhbmRsZWQgYnkgdGhlIG91dHB1dCAobGlzdCkuXHJcbiAgKi9cclxuICBleHBvcnQgZnVuY3Rpb24gcmVwb3J0KG1lc3NhZ2VzOiBJTWVzc2FnZVtdKTogdm9pZCB7XHJcblxyXG4gICAgaWYgKCFtZXNzYWdlcykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGNhY2hlOiBJQ2FjaGUgPSB7fTtcclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBvciBjb252ZXJ0IG91dHB1dCBsaXN0c1xyXG4gICAgdmFyIG91dHB1dHM6IElPdXRwdXRbXSA9IFtdO1xyXG4gICAgaWYgKHR5cGVvZiBvdXRwdXQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgb3V0cHV0cyA9IDxhbnk+W291dHB1dF07XHJcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkob3V0cHV0KSkge1xyXG4gICAgICBpZiAoKDxJT3V0cHV0W10+b3V0cHV0KS5zb21lKG8gPT4gdHlwZW9mIG8gIT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdyZXBvcnRlcnMub3V0cHV0IG5lZWRzIGEgZnVuY3Rpb24gb3IgYXJyYXkgb2YgZnVuY3Rpb25zIHRvIHJlcG9ydCBtZXNzYWdlcy4nKTtcclxuICAgICAgfVxyXG4gICAgICBvdXRwdXRzID0gPGFueT5vdXRwdXQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3JlcG9ydGVycy5vdXRwdXQgbmVlZHMgYSBmdW5jdGlvbiBvciBhcnJheSBvZiBmdW5jdGlvbnMgdG8gcmVwb3J0IG1lc3NhZ2VzLicpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGNoZWNrIGZvciBzb3VyY2VtYXBcclxuICAgIG1lc3NhZ2VzLmZvckVhY2goKG1lc3NhZ2U6IElNZXNzYWdlKSA9PiB7XHJcblxyXG4gICAgICAvLy8gQWRkIHNvdXJjZW1hcCBpbmZvcm1hdGlvbj9cclxuICAgICAgaWYgKCFtZXNzYWdlLm9wdGlvbnMgfHwgbWVzc2FnZS5vcHRpb25zLnNvdXJjZU1hcHMgIT09IGZhbHNlKSB7XHJcblxyXG4gICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBjaGVja2luZyBmb3Igc291cmNlbWFwcy4uLicpO1xyXG4gICAgICAgIHZhciBzb3VyY2VNYXAgPSBnZXRTb3VyY2VNYXAobWVzc2FnZSwgY2FjaGUpO1xyXG4gICAgICAgIGlmIChzb3VyY2VNYXApIHtcclxuXHJcbiAgICAgICAgICAvLyBUcnkgdG8gZ2V0IG9yaWdpbmFsIGxvY2F0aW9uXHJcbiAgICAgICAgICBsb2dEZWJ1ZyhtZXNzYWdlLmZpbGVQYXRoICsgJzogZ2V0IG9yaWdpbmFsIGxvY2F0aW9uIG9mIGxpbmUgJyArIG1lc3NhZ2UubGluZU5iciArICcsIGNvbCAnICsgbWVzc2FnZS5jb2xOYnIpO1xyXG4gICAgICAgICAgdmFyIHNtYyA9IG5ldyBTb3VyY2VNYXBDb25zdW1lcihzb3VyY2VNYXApO1xyXG5cclxuICAgICAgICAgIHZhciBvcmlnaW5hbCA9IHNtYy5vcmlnaW5hbFBvc2l0aW9uRm9yKHsgbGluZTogbWVzc2FnZS5saW5lTmJyIC0gMSwgY29sdW1uOiBtZXNzYWdlLmNvbE5iciAtIDF9KTtcclxuICAgICAgICAgIGxvZ0RlYnVnKG1lc3NhZ2UuZmlsZVBhdGggKyAnOiBvcmlnaW5hbCBsb2NhdGlvbiByZXN1bHQ6ICcgKyBKU09OLnN0cmluZ2lmeShvcmlnaW5hbCkpO1xyXG5cclxuICAgICAgICAgIGlmIChvcmlnaW5hbCAmJiBvcmlnaW5hbC5zb3VyY2UpIHtcclxuICAgICAgICAgICAgbG9nRGVidWcobWVzc2FnZS5maWxlUGF0aCArICc6IHVwZGF0aW5nIG1lc3NhZ2Ugd2l0aCBzb3VyY2VtYXAgbG9jYXRpb24nKTtcclxuICAgICAgICAgICAgbWVzc2FnZS5maWxlUGF0aCA9IG9yaWdpbmFsLnNvdXJjZTtcclxuICAgICAgICAgICAgbWVzc2FnZS5saW5lTmJyID0gb3JpZ2luYWwubGluZSArIDE7XHJcbiAgICAgICAgICAgIG1lc3NhZ2UuY29sTmJyID0gb3JpZ2luYWwuY29sdW1uICsgMTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxvZ0RlYnVnKCdsaW5lICYgY29sdW1uIG5vdCBmb3VuZCBpbiBzb3VyY2VNYXAnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEZpbHRlciBvciB1cGRhdGUgbWVzc2FnZXNcclxuICAgIGlmIChyZXBvcnRlcnMuZmlsdGVyT3JVcGRhdGUpIHsgLy8gdXNlIHJlcG9ydGVycy4gdG8gcHJldmVudCBjbG9zdXJlXHJcbiAgICAgIGxvZ0RlYnVnKCdGaWx0ZXJpbmcgbWVzc2FnZXM6IGZpbHRlck9yVXBkYXRlJyk7XHJcbiAgICAgIG1lc3NhZ2VzID0gcmVwb3J0ZXJzLmZpbHRlck9yVXBkYXRlKG1lc3NhZ2VzKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZXBvcnRcclxuICAgIGxvZ0RlYnVnKCcjIE91dHB1dHM6ICcgKyBvdXRwdXRzLmxlbmd0aCk7XHJcbiAgICBvdXRwdXRzLmZvckVhY2gob3V0cHV0UmVwb3J0ZXIgPT4ge1xyXG4gICAgICBvdXRwdXRSZXBvcnRlcihtZXNzYWdlcyk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgPSByZXBvcnRlcnM7XHJcbiJdfQ==